/*! autoKana2-vanilla 1.0.31.2
 * MIT License
 * (c) 2023 Gakuto Matsumura (http://github.com/GakutoMatsumura)
 * Based on the autoKana2(1.0.31) library created by:
 * (c) 2016 Very.Pinch (very.pinch@gmail.com)
 * Based on the AutoKana library created by:
 * (c) 2013 Keith Perhac @ DelfiNet (http://delfi-net.com)
 * Based on the AutoRuby library created by:
 * (c) 2005-2008 spinelz.org (http://script.spinelz.org/)
*/ !function(e,$){e.autoKana2=function(t,n,a){let x=RegExp("[^　ぁ-ゖァ-ヶＡ-Ｚａ-ｚ０-９‘～｀！＠＃＄％＾＆＊（）＿ー－＝＋｛｝「」［］￥＼｜；：’”＜＞、。，．・？／♪€…☆→○×÷〒々〆]","g"),l=RegExp("[^　ァ-ヶー]","g"),i=RegExp("[ｎＮnN]","g"),r=RegExp("[^ｍＭmM]","g");var F=$.querySelector(t),s=$.querySelector(n);if(!F||!s)return;F.dataset.notSupport=0;var o="",g="",u="",h="",c=!1,f="",d=!1,_="",p="",C=!1,v=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"";let b=Object.assign({katakana:!1,addRubyCallback:function(e){},emptyInputCallback:function(){return!0}},a);var E=v.indexOf("msie")>-1&&-1==v.indexOf("opera"),A=v.indexOf("trident/7")>-1,k=E||A,O=v.indexOf("edge")>-1,B=v.indexOf("firefox")>-1,D=v.indexOf("safari")>-1&&-1==v.indexOf("chrome"),m=v.indexOf("Opera")>-1,S=!1;if(v.indexOf("chrome")>-1&&v.indexOf("opr")>-1){m=!0;var y=v.indexOf("opr");(v.slice(y+4).indexOf("42.0")>-1||v.slice(y+4).indexOf("43.0")>-1)&&(S=!0)}var K=!1,L=!1;if(v.indexOf("chrome")>-1&&-1==v.indexOf("opr")){K=!0;var y=v.indexOf("chrome"),W=v.indexOf(" ",y);(v.substring(y+7,W).indexOf("55.0")>-1||v.substring(y+7,W).indexOf("56.0")>-1)&&(L=!0)}var w=v.indexOf("mobile nintendobrowser")>-1;function I(){f="",u="",s&&(s.value="")}function P(e){var $=b.katakana?e.toKatakanaCase():e.toHiraganaCase();s.value=s.value+M($),b.addRubyCallback(M($))}function M(e){var $=e;return e.toKatakanaCase().replace(l,"").replace("　","").length>0&&0===e.substring(e.length-1).replace(i,"").length&&($=e.substring(0,e.length-1),$+=b.katakana?"ン":"ん"),$}function N(e,$){0===e.replace(r,"").length&&$.replace(r,"").length>0&&(F.dataset.notSupport=1)}F.addEventListener("change",function(e){var $=F.value;(!$||0==$.length)&&b.emptyInputCallback()&&I()}),F.addEventListener("keyup",function(e){if(8===e.keyCode){d=!1;var $=F.value;0===$.length?b.emptyInputCallback()&&I():"　"===$.substring($.length-1)&&(d=!0)}}),F.addEventListener("focus",function(){F.dataset.notSupport=0,(f=F.value).length>0&&"　"===f.slice(f.length-1)&&(d=!0)}),F.addEventListener("blur",function(){1===F.dataset.notSupport&&alert("正しくルビを取得出来無かった可能性が有ります。")}),F.addEventListener("compositionstart",function($){if(o="",p="",u=F.value,k||O||B){if((p=F.value.slice(F.selectionStart,F.selectionEnd)).length>0)u=u.slice(0,F.selectionStart)+u.slice(F.selectionEnd,u.length),B&&g.length>0&&$.originalEvent&&g===$.originalEvent.data&&(C=!0);else if(g.length>0&&$.originalEvent&&g===$.originalEvent.data){let t=s.value;s.value=t.substring(0,t.length-g.length),o=$.originalEvent.data,c=!0}}if(g="",_="",e.getSelection&&F.selectionStart<F.selectionEnd&&u.length>0&&"　"===u.substring(F.selectionStart-1,1)&&(d=!0),(L||S)&&(F.selectionStart<F.selectionEnd||F.selectionEnd<u.length)&&(_=u.substring(F.selectionEnd),u=u.substring(0,F.selectionStart)),!d&&(K||m||D||w))for(let n=u.length-1;n>-1;n--){let a=u.substring(n,1);if("　"===a)s.value+=a;else break}}),F.addEventListener("compositionupdate",function(e){var $=e.data,t=$.toWideCase().replace(x,""),n=!1;if($.toWideCase().length===t.length){d=!1;var a=o.toWideCase().toKatakanaCase().replace(l,""),i=t.toWideCase().toKatakanaCase(),r=i.replace(l,"");if(a.length>0&&r.length>0&&o.toWideCase().toKatakanaCase()===i)return;if(L||S)setTimeout(function(){var e=F.value;if(_.length>0&&(e=e.substring(0,e.length-_.length)),e.substring(0,u.length)===u&&e.substring(e.length-t.length)===t&&(r=(i=toWideCase(t=e.substring(u.length,e.length)).toKatakanaCase()).replace(l,"")),!(a.length>0)||!(t.length>0)||0!==r.length){if(F.selectionStart===F.value.length){let $=i.substring(i.length-1).replace(l,"");if(0!==$.length){let n="",x=o.length-1;do{let s=toKatakanaCase(o.substring(x,1));if(0!==s.replace(l,"").length){n=toKatakanaCase(o.substring(0,x+1));break}x--}while(x>-1);if(i.substring(0,n.length)!==n.substring(0,i.length))return}}o=t.length>0?t:o.substring(0,o.length-1)}},0);else{if(C&&p!==t&&(C=!1),k||O){let s=F.value;if(s.substring(0,u.length)===u){let g=s.substring(u.length,s.length-u.length);g!==$&&(P(o),u=F.value.substring(0,F.value.length-1),c=!1,n=!0)}}if(!n&&a.length>0&&t.length>0&&0===r.length)return;if(F.selectionStart==F.value.length&&0!==i.charAt(i.length-1).replace(l,"").length){var f="",v=o.length-1;do{if(0!==o.charAt(v).toKatakanaCase().replace(l,"").length){f=o.substring(0,v+1).toKatakanaCase();break}v--}while(v>-1);if(i.substring(0,f.length)!==f.substring(0,i.length))return}C?o="":t.length>0&&(o=t),C=!1}}else h.length-$.length==1&&h.substring(0,$.length)===$&&(F.dataset.notSupport=1);h=$,n&&N($,o)}),F.addEventListener("compositionend",function(e){var $=e.data,t=F.value;g="";var n=!1;if((k||O)&&0===$.length&&o.length>0&&t!==u&&(n=!0),($.length>0||c||n)&&(P(o),g=o,c=!1,N($,o),o=""),(k||O)&&u.length<t.length&&t.substring(0,u.length)===u){var a=t.substring(u.length,t.length-u.length);"　"===a&&(s.value=s.value+a)}})},e.autoKana=e.autoKana2}(window,document),String.prototype.toKatakanaCase=function(){return this.replace(/[\u3041-\u3096]/g,function(e){return String.fromCharCode(e.charCodeAt(0)+96)})},String.prototype.toHiraganaCase=function(){return this.replace(/[\u30a1-\u30f6]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-96)})},String.prototype.toWideCase=function(){var e,$,t,n,a=[],x=String.prototype.toWideCase.MAPPING;for(e=0,$=this.length;e<$;)switch(t=this.charCodeAt(e++),n=this.charCodeAt(e),!0){case 33<=t&&t<=126&&!(34==t||39==t||92==t):a.push(t+65248);break;case 65395==t:if(65438==n){a.push(12532),e++;break}case 65398<=t&&t<=65414:if(65438==n){a.push(x[t]+1),e++;break}case 65418<=t&&t<=65422:if(65438==n||65439==n){a.push(x[t]+(n-65437)),e++;break}case t in x:a.push(x[t]);break;default:a.push(t)}return String.fromCharCode.apply(null,a)},String.prototype.toWideCase.MAPPING={92:65509,45:8213,39:8217,34:8221,32:12288,65380:12289,65377:12290,65378:12300,65379:12301,65438:12443,65439:12444,65383:12449,65393:12450,65384:12451,65394:12452,65385:12453,65395:12454,65386:12455,65396:12456,65387:12457,65397:12458,65398:12459,65399:12461,65400:12463,65401:12465,65402:12467,65403:12469,65404:12471,65405:12473,65406:12475,65407:12477,65408:12479,65409:12481,65391:12483,65410:12484,65411:12486,65412:12488,65413:12490,65414:12491,65415:12492,65416:12493,65417:12494,65418:12495,65419:12498,65420:12501,65421:12504,65422:12507,65423:12510,65424:12511,65425:12512,65426:12513,65427:12514,65388:12515,65428:12516,65389:12517,65429:12518,65390:12519,65430:12520,65431:12521,65432:12522,65433:12523,65434:12524,65435:12525,65436:12527,65382:12530,65437:12531,65381:12539,65392:12540};