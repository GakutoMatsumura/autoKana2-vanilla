/*! autoKana2-vanilla 1.0.31.3
 * MIT License
 * (c) 2023 Gakuto Matsumura (http://github.com/GakutoMatsumura)
 * Based on the autoKana2(1.0.31) library created by:
 * (c) 2016 Very.Pinch (very.pinch@gmail.com)
 * Based on the AutoKana library created by:
 * (c) 2013 Keith Perhac @ DelfiNet (http://delfi-net.com)
 * Based on the AutoRuby library created by:
 * (c) 2005-2008 spinelz.org (http://script.spinelz.org/)
*/
!function(e,t){e.autoKana2=function(n,a,i){const r=new RegExp("[^　ぁ-ゖァ-ヶＡ-Ｚａ-ｚ０-９‘～｀！＠＃＄％＾＆＊（）＿ー－＝＋｛｝「」［］￥＼｜；：’”＜＞、。，．・？／♪€…☆→○×÷〒々〆゛゜]","g"),l=new RegExp("[^　ぁ-ゖァ-ヶー]","g"),s=new RegExp("[ｎＮnN]","g"),o=new RegExp("[^ｍＭmM]","g"),g=/[\u3041-\u3096\u30A1-\u30F6]+/g;var u=t.querySelector(n),h=t.querySelector(a);if(!u||!h)return;u.dataset.notSupport=0;var c="",d="",f="",p="",v=!1,b="",C=!1,k="",S="",x=!1,E=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"";const m=Object.assign({katakana:!1,notSupportAlert:!1,addRubyCallback:function(e){},emptyInputCallback:function(){return!0}},i);var O=E.indexOf("msie")>-1&&-1==E.indexOf("opera"),y=E.indexOf("trident/7")>-1,A=O||y,K=E.indexOf("edge")>-1,w=E.indexOf("firefox")>-1,W=E.indexOf("safari")>-1&&-1==E.indexOf("chrome"),L=E.indexOf("Opera")>-1,R=!1;if(E.indexOf("chrome")>-1&&E.indexOf("opr")>-1){L=!0;let e=E.indexOf("opr");(E.slice(e+4).indexOf("42.0")>-1||E.slice(e+4).indexOf("43.0")>-1)&&(R=!0)}var I=!1,P=!1;if(E.indexOf("chrome")>-1&&-1==E.indexOf("opr")){I=!0;let e=E.indexOf("chrome"),t=E.indexOf(" ",e);(E.substring(e+7,t).indexOf("55.0")>-1||E.substring(e+7,t).indexOf("56.0")>-1)&&(P=!0)}var F=E.indexOf("mobile nintendobrowser")>-1;function M(){b="",f="",h.value=""}function N(e){const t=m.katakana?e.toKatakanaCase():e.toHiraganaCase();var n=t;t.toKatakanaCase().replace(l,"").replace("　","").length>0&&0===t.substring(t.length-1).replace(s,"").length&&(n=t.substring(0,t.length-1)+(m.katakana?"ン":"ん")),h.value=h.value+n.replace(l,""),m.addRubyCallback(n)}function q(e,t){0===e.replace(o,"").length&&t.replace(o,"").length>0&&(u.dataset.notSupport=1)}u.addEventListener("change",(function(e){var t=u.value;t&&0!=t.length||!m.emptyInputCallback()||M()})),u.addEventListener("keyup",(function(e){if(8===e.keyCode||46===e.keyCode){C=!1;var t=u.value;0===t.length?m.emptyInputCallback()&&M():"　"===t.substring(t.length-1)&&(C=!0)}})),u.addEventListener("focus",(function(){u.dataset.notSupport=0,(b=u.value).length>0&&"　"===b.slice(b.length-1)&&(C=!0)})),m.notSupportAlert&&u.addEventListener("blur",(function(){1===u.dataset.notSupport&&alert("正しくルビを取得出来無かった可能性が有ります。")})),u.addEventListener("compositionstart",(function(t){if(c="",S="",f=u.value,A||K||w)if((S=u.value.slice(u.selectionStart,u.selectionEnd)).length>0)f=f.slice(0,u.selectionStart)+f.slice(u.selectionEnd,f.length),w&&d.length>0&&t.originalEvent&&d===t.originalEvent.data&&(x=!0);else if(d.length>0&&t.originalEvent&&d===t.originalEvent.data){let e=h.value;h.value=e.substring(0,e.length-d.length),c=t.originalEvent.data,v=!0}if(d="",k="",e.getSelection&&u.selectionStart<u.selectionEnd&&f.length>0&&"　"===f.substring(u.selectionStart-1,1)&&(C=!0),(P||R)&&(u.selectionStart<u.selectionEnd||u.selectionEnd<f.length)&&(k=f.substring(u.selectionEnd),f=f.substring(0,u.selectionStart)),!C&&(I||L||W||F))for(let e=f.length-1;e>-1;e--){const t=f.substring(e,1);if("　"!==t)break;h.value+=t}})),u.addEventListener("compositionupdate",(function(e){var t=e.data,n=t.toWideCase().replace(r,""),a=!1;if(t.toWideCase().length===n.length){C=!1;var i=c.toWideCase().toKatakanaCase().replace(l,""),s=n.toWideCase().toKatakanaCase(),o=s.replace(l,"");if(i.length>0&&o.length>0&&c.toWideCase().toKatakanaCase()===s)return;if(P||R)setTimeout((function(){var e=u.value;if(k.length>0&&(e=e.substring(0,e.length-k.length)),e.substring(0,f.length)===f&&e.substring(e.length-n.length)===n&&(n=e.substring(f.length,e.length),s=toWideCase(n).toKatakanaCase(),o=s.replace(l,"")),!(i.length>0&&n.length>0&&0===o.length)){if(u.selectionStart===u.value.length){if(0!==s.substring(s.length-1).replace(l,"").length){let e="",t=c.length-1;do{if(0!==c.charAt(t).toKatakanaCase().replace(l,"").length){e=c.substring(0,t+1).toKatakanaCase();break}--t}while(t>-1);let n=s.substring(0,e.length),a=e.substring(0,s.length);if(n.match(g)===a.match(g)&&n!==a)return}}c=n.length>0?n:c.substring(0,c.length-1)}}),0);else{if(x&&S!==n&&(x=!1),A||K){const e=u.value;if(e.substring(0,f.length)===f){e.substring(f.length,e.length-f.length)!==t&&(N(c),f=u.value.substring(0,u.value.length-1),v=!1,a=!0)}}if(!a&&i.length>0&&n.length>0&&0===o.length)return;if(u.selectionStart==u.value.length){if(0!==s.charAt(s.length-1).replace(l,"").length){let e="",t=c.length-1;do{if(0!==c.charAt(t).toKatakanaCase().replace(l,"").length){e=c.substring(0,t+1).toKatakanaCase();break}t--}while(t>-1);let n=s.substring(0,e.length),a=e.substring(0,s.length);if(n.match(g)===a.match(g)&&n!==a)return}}x?c="":n.length>0&&(c=n),x=!1}}else p.length-t.length==1&&p.substring(0,t.length)===t&&(u.dataset.notSupport=1);p=t,a&&q(t,c)})),u.addEventListener("compositionend",(function(e){var t=e.data,n=u.value;d="";var a=!1;if((A||K)&&0===t.length&&c.length>0&&n!==f&&(a=!0),(t.length>0||v||a)&&(N(c),d=c,v=!1,q(t,c),c=""),(A||K)&&f.length<n.length&&n.substring(0,f.length)===f){var i=n.substring(f.length,n.length-f.length);"　"===i&&(h.value=h.value+i)}}))},e.autoKana=e.autoKana2}(window,document),String.prototype.toKatakanaCase=function(){return this.replace(/[\u3041-\u3096\u3099-\u309E\u30F4\u309A]/g,(function(e){const t=e.charCodeAt(0);return String.fromCharCode(t+(t<12441?96:98))}))},String.prototype.toHiraganaCase=function(){return this.replace(/[\u30a1-\u30f6\u3099-\u309E\u30F4\u309A]/g,(function(e){const t=e.charCodeAt(0);return String.fromCharCode(t-(t>=12541?96:95))}))},String.prototype.toWideCase=function(){var e,t,n,a,i=[],r=String.prototype.toWideCase.MAPPING;for(e=0,t=this.length;e<t;)switch(n=this.charCodeAt(e++),a=this.charCodeAt(e),!0){case 33<=n&&n<=126&&!(34==n||39==n||92==n):i.push(n+65248);break;case 65395==n:if(65438==a){i.push(12532),e++;break}case 65398<=n&&n<=65414:if(65438==a){i.push(r[n]+1),e++;break}case 65418<=n&&n<=65422:if(65438==a||65439==a){i.push(r[n]+(a-65437)),e++;break}case n in r:i.push(r[n]);break;default:i.push(n)}return String.fromCharCode.apply(null,i)},String.prototype.toWideCase.MAPPING={92:65509,45:8213,39:8217,34:8221,32:12288,65380:12289,65377:12290,65378:12300,65379:12301,65438:12443,65439:12444,65383:12449,65393:12450,65384:12451,65394:12452,65385:12453,65395:12454,65386:12455,65396:12456,65387:12457,65397:12458,65398:12459,65399:12461,65400:12463,65401:12465,65402:12467,65403:12469,65404:12471,65405:12473,65406:12475,65407:12477,65408:12479,65409:12481,65391:12483,65410:12484,65411:12486,65412:12488,65413:12490,65414:12491,65415:12492,65416:12493,65417:12494,65418:12495,65419:12498,65420:12501,65421:12504,65422:12507,65423:12510,65424:12511,65425:12512,65426:12513,65427:12514,65388:12515,65428:12516,65389:12517,65429:12518,65390:12519,65430:12520,65431:12521,65432:12522,65433:12523,65434:12524,65435:12525,65436:12527,65382:12530,65437:12531,65381:12539,65392:12540};